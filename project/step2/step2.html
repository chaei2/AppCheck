<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>ìëª¨ íƒ€ì„ë¼ì¸ â€¢ ìŠ¤í¬ë¡¤/í•˜ì´ë¼ì´íŠ¸/íƒ€ì¼ë§ ë°ëª¨</title>
    <meta name="theme-color" content="#0f1115" />
    <style>
      :root {
        --bg: #0f1115;
        --panel: #151924;
        --ink: #e7ecf3;
        --muted: #8b95a7;
        --accent: #73c1ff;
        --hit: #9ad1ff;
        --key: #0e121a;
        --line: #222a3a;
      }
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      html,
      body {
        margin: 0;
        background: var(--bg);
        color: var(--ink);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto,
          Noto Sans KR, Helvetica, Arial;
      }
      .wrap {
        max-width: 980px;
        margin: 0 auto;
        padding: 16px;
      }

      /* ìƒë‹¨ ë‚ ì§œ ë ˆì¼(ìŠ¤í¬ë¡¤í•´ë„ ë¶™ì–´ìˆëŠ” í—¤ë”) */
      .rail {
        position: sticky;
        top: 0;
        z-index: 5;
        background: linear-gradient(#0f1115, #0f1115cc 70%, transparent);
        padding: 8px 0 10px;
        backdrop-filter: saturate(1.2) blur(4px);
      }
      .rail .chips {
        display: flex;
        gap: 8px;
        overflow: auto;
        padding-bottom: 6px;
        scrollbar-width: none;
      }
      .rail .chips::-webkit-scrollbar {
        display: none;
      }
      .chip {
        flex: 0 0 auto;
        padding: 8px 10px;
        border: 1px solid var(--line);
        background: var(--panel);
        color: var(--muted);
        border-radius: 999px;
        font-weight: 700;
        font-size: 12px;
        cursor: pointer;
      }
      .chip.active {
        color: #09111a;
        background: var(--accent);
        border-color: transparent;
      }
      .progress {
        height: 3px;
        background: #1a2232;
        border-radius: 99px;
        overflow: hidden;
      }
      .progress > span {
        display: block;
        height: 100%;
        width: 0%;
        background: var(--accent);
      }

      /* ë°ì´ ì¹´ë“œ */
      .day {
        scroll-margin-top: 92px;
        margin: 18px 0 24px;
        padding: 14px;
        border-radius: 16px;
        background: var(--panel);
        border: 1px solid var(--line);
      }
      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
        color: var(--muted);
        font-size: 13px;
      }
      .meta b {
        color: var(--ink);
      }
      .quote {
        margin: 10px 0 12px;
        font-size: 18px;
        line-height: 1.5;
      }
      .book {
        font-size: 12px;
        color: var(--muted);
      }

      /* ë¯¸ë‹ˆ ìíŒ(32í‚¤) */
      .kbd {
        display: grid;
        grid-template-columns: repeat(14, minmax(0, 1fr));
        gap: 6px;
      }
      .row {
        display: contents;
      }
      .key {
        position: relative;
        background: var(--key);
        color: #9aa6bf;
        border: 1px solid #202636;
        border-radius: 8px;
        padding: 8px 0;
        text-align: center;
        user-select: none;
        font-weight: 700;
        cursor: pointer;
      }
      .key.space {
        grid-column: 1 / -1;
        padding: 14px 0;
        letter-spacing: 3px;
      }
      .key.hit {
        color: #dff1ff;
        outline: 2px solid #1c2a3e;
        box-shadow: 0 0 0 2px rgba(115, 193, 255, 0.2) inset;
        background: linear-gradient(180deg, #132033, #0e121a);
      }
      .key .badge {
        position: absolute;
        bottom: 6px;
        right: 6px;
        font-size: 10px;
        color: #09111a;
        background: var(--hit);
        border-radius: 8px;
        padding: 2px 6px;
        font-weight: 900;
      }

      /* ê°¤ëŸ¬ë¦¬ ì˜¤ë²„ë ˆì´ */
      .sheet {
        position: fixed;
        inset: 0;
        display: none;
        align-items: flex-end;
        justify-content: center;
        z-index: 10;
      }
      .sheet.show {
        display: flex;
      }
      .sheet .panel {
        width: min(960px, 100%);
        max-height: 86vh;
        background: #0b0e15;
        border: 1px solid #223049;
        border-top-left-radius: 16px;
        border-top-right-radius: 16px;
        padding: 12px;
        overflow: auto;
      }
      .sheet .head {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
        position: sticky;
        top: 0;
        background: #0b0e15;
        padding: 4px 0 10px;
      }
      .x {
        border: 0;
        background: #122031;
        color: #cfe9ff;
        border: 1px solid #223049;
        border-radius: 8px;
        padding: 6px 10px;
        cursor: pointer;
        font-weight: 700;
      }
      .tile {
        width: 100%;
        aspect-ratio: 1/1;
        background: #0e121a;
        border: 1px solid #223049;
        border-radius: 10px;
        overflow: hidden;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }
      .tile img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
      .ph {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #9ec9ff;
        font-weight: 900;
        font-size: 20px;
        letter-spacing: 2px;
        background: repeating-linear-gradient(
          45deg,
          #0f1624 0px,
          #0f1624 10px,
          #0d1320 10px,
          #0d1320 20px
        );
      }

      @media (max-width: 640px) {
        .grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .quote {
          font-size: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <!-- ìƒë‹¨ ë‚ ì§œ ë ˆì¼ -->
      <div class="rail">
        <div id="chips" class="chips"></div>
        <div class="progress"><span id="prog"></span></div>
      </div>

      <!-- ë°ì´ ì„¹ì…˜ ì»¨í…Œì´ë„ˆ -->
      <div id="days"></div>
    </div>

    <!-- ìëª¨ ê°¤ëŸ¬ë¦¬ ì‹œíŠ¸ -->
    <div id="sheet" class="sheet" aria-hidden="true">
      <div class="panel">
        <div class="head">
          <div id="sheetTitle" style="font-weight: 800">ìëª¨ íƒ€ì¼</div>
          <button class="x" id="closeSheet">ë‹«ê¸°</button>
        </div>
        <div id="gallery" class="grid"></div>
      </div>
    </div>

    <script>
      // ===== 1) ë°ì´í„°(ìƒ˜í”Œ 3ì¼) â€” ì—¬ê¸°ì— 30ì¼ì¹˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. =====
      // ê° day.photos[ìëª¨] = [ê·¸ ìëª¨ì™€ ê´€ë ¨ëœ ì‚¬ì§„ ê²½ë¡œ ë°°ì—´]
      const DAYS = [
        {
          date: '2025-09-01',
          time: '21:15',
          book: 'ì‚¬ë¬¼ì˜ ì–¸ì–´',
          quote: 'ì‚¬ì†Œí•œ ë¬¸ì¥ ì†ì—ì„œ ìˆ¨ ê³ ë¥´ëŠ” ë²•ì„ ë°°ìš´ë‹¤.',
          photos: {
            ã……: ['assets/ã……/01.jpg', 'assets/ã……/02.jpg'],
            ã…: ['assets/ã…/01.jpg'],
            ã…: ['assets/ã…/01.jpg'],
          },
        },
        {
          date: '2025-09-03',
          time: '22:40',
          book: 'ë°¤ì˜ ë…ì„œ',
          quote: 'ê¹Šì€ ë°¤, ë¬¸ì¥ê³¼ ë¬¸ì¥ ì‚¬ì´ì˜ ê³µë°±ì´ ë” í¬ê²Œ ë“¤ë¦°ë‹¤.',
          photos: {
            ã…‚: ['assets/ã…‚/01.jpg'],
            ã…: ['assets/ã…/02.jpg'],
            'âµ': ['assets/space/01.jpg'],
          },
        },
        {
          date: '2025-09-07',
          time: '19:05',
          book: 'ë‚­ë…ì˜ ê¸°ìˆ ',
          quote: 'ë‚­ë…ì€ í˜¸í¡ì´ê³ , í˜¸í¡ì€ ì˜ë¯¸ë¥¼ ë§Œë“ ë‹¤.',
          photos: {
            ã…: ['assets/ã…/01.jpg', 'assets/ã…/02.jpg'],
            ã…—: ['assets/ã…—/01.jpg'],
            ã…¢: ['assets/ã…¢/01.jpg'],
          },
        },
      ];

      // ===== 2) ìíŒ ë ˆì´ì•„ì›ƒ(32í‚¤) =====
      const ROW1 = [
        'ã…‚',
        'ã…ˆ',
        'ã„·',
        'ã„±',
        'ã……',
        'ã…',
        'ã„´',
        'ã…‡',
        'ã„¹',
        'ã…',
        'ã…‹',
        'ã…Œ',
        'ã…Š',
        'ã…',
      ];
      const TENSE = ['ã…ƒ', 'ã…‰', 'ã„¸', 'ã„²', 'ã…†'];
      const ROW2 = [
        'ã…›',
        'ã…•',
        'ã…‘',
        'ã…',
        'ã…”',
        'ã…—',
        'ã…“',
        'ã…',
        'ã…£',
        'ã… ',
        'ã…œ',
        'ã…¡',
      ];
      const SPACE = ['âµ'];
      const KEYSET = new Set([...ROW1, ...TENSE, ...ROW2, ...SPACE]);

      // ===== 3) í•œê¸€ ë¶„í•´ â†’ ìëª¨ ë¦¬ìŠ¤íŠ¸(ëœì†Œë¦¬/ê²¹ë°›ì¹¨/ê²¹ëª¨ìŒ ë¶„í•´ í¬í•¨) =====
      const CHO = [
        'ã„±',
        'ã„²',
        'ã„´',
        'ã„·',
        'ã„¸',
        'ã„¹',
        'ã…',
        'ã…‚',
        'ã…ƒ',
        'ã……',
        'ã…†',
        'ã…‡',
        'ã…ˆ',
        'ã…‰',
        'ã…Š',
        'ã…‹',
        'ã…Œ',
        'ã…',
        'ã…',
      ];
      const JUNG = [
        'ã…',
        'ã…',
        'ã…‘',
        'ã…’',
        'ã…“',
        'ã…”',
        'ã…•',
        'ã…–',
        'ã…—',
        'ã…˜',
        'ã…™',
        'ã…š',
        'ã…›',
        'ã…œ',
        'ã…',
        'ã…',
        'ã…Ÿ',
        'ã… ',
        'ã…¡',
        'ã…¢',
        'ã…£',
      ];
      const JONG = [
        '',
        'ã„±',
        'ã„²',
        'ã„³',
        'ã„´',
        'ã„µ',
        'ã„¶',
        'ã„·',
        'ã„¹',
        'ã„º',
        'ã„»',
        'ã„¼',
        'ã„½',
        'ã„¾',
        'ã„¿',
        'ã…€',
        'ã…',
        'ã…‚',
        'ã…„',
        'ã……',
        'ã…†',
        'ã…‡',
        'ã…ˆ',
        'ã…Š',
        'ã…‹',
        'ã…Œ',
        'ã…',
        'ã…',
      ];
      const JONG_SPLIT = {
        ã„³: ['ã„±', 'ã……'],
        ã„µ: ['ã„´', 'ã…ˆ'],
        ã„¶: ['ã„´', 'ã…'],
        ã„º: ['ã„¹', 'ã„±'],
        ã„»: ['ã„¹', 'ã…'],
        ã„¼: ['ã„¹', 'ã…‚'],
        ã„½: ['ã„¹', 'ã……'],
        ã„¾: ['ã„¹', 'ã…Œ'],
        ã„¿: ['ã„¹', 'ã…'],
        ã…€: ['ã„¹', 'ã…'],
        ã…„: ['ã…‚', 'ã……'],
      };
      const JUNG_SPLIT = {
        ã…˜: ['ã…—', 'ã…'],
        ã…™: ['ã…—', 'ã…'],
        ã…š: ['ã…—', 'ã…£'],
        ã…: ['ã…œ', 'ã…“'],
        ã…: ['ã…œ', 'ã…”'],
        ã…Ÿ: ['ã…œ', 'ã…£'],
        ã…¢: ['ã…¡', 'ã…£'],
        ã…’: ['ã…‘', 'ã…'],
        ã…–: ['ã…•', 'ã…”'],
      };

      function decomposeToJamo(text) {
        const out = [];
        for (const ch of text) {
          if (ch === ' ') {
            out.push('âµ');
            continue;
          }
          const code = ch.charCodeAt(0);
          if (code < 0xac00 || code > 0xd7a3) {
            // í•œê¸€ ìŒì ˆì´ ì•„ë‹ˆë©´, ê·¸ëŒ€ë¡œ ë‘ë˜ í‚¤ì…‹ì— ìˆìœ¼ë©´ ë°˜ì˜
            if (KEYSET.has(ch)) out.push(ch);
            continue;
          }
          const S = code - 0xac00;
          const ci = Math.floor(S / (21 * 28));
          const vi = Math.floor((S % (21 * 28)) / 28);
          const ti = S % 28;
          let c = CHO[ci];
          let v = JUNG[vi];
          let t = JONG[ti];
          // ëœì†Œë¦¬ëŠ” ê·¸ëŒ€ë¡œ(ã…ƒã…‰ã„¸ã„²ã…†)
          // ê²¹ëª¨ìŒ/ê²¹ë°›ì¹¨ ë¶„í•´í•˜ì—¬ í‚¤ì…‹(ê¸°ë³¸ 12ëª¨ìŒ/14ììŒ/ëœì†Œë¦¬5)ì— ë§¤í•‘
          const vs = JUNG_SPLIT[v] || [v];
          const ts = t ? JONG_SPLIT[t] || [t] : [];
          // ì¶œë ¥
          out.push(c, ...vs, ...ts);
        }
        // í‚¤ë³´ë“œì— ì—†ëŠ” ê¸°í˜¸ ì œê±°
        return out.filter((j) => KEYSET.has(j));
      }

      // ===== 4) DOM ë¹Œë“œ =====
      const daysEl = document.getElementById('days');
      const chipsEl = document.getElementById('chips');
      const progEl = document.getElementById('prog');

      // ë°ì´ ì„¹ì…˜ ìƒì„±
      DAYS.forEach((d, i) => {
        const sec = document.createElement('section');
        sec.className = 'day';
        sec.dataset.idx = i;
        sec.innerHTML = `
        <div class="meta">ğŸ“… <b>${d.date}</b> Â· â° ${d.time} Â· <span class="book">${d.book}</span></div>
        <div class="quote">${d.quote}</div>
        <div class="kbd" aria-label="ë¯¸ë‹ˆ ìíŒ"></div>
      `;
        daysEl.appendChild(sec);
        // í‚¤ë³´ë“œ ë Œë”
        const used = decomposeToJamo(d.quote);
        const counts = Object.create(null);
        used.forEach((k) => (counts[k] = (counts[k] || 0) + 1));
        const kbd = sec.querySelector('.kbd');
        buildRow(kbd, ROW1, counts);
        buildRow(kbd, TENSE, counts, 5);
        buildRow(kbd, ROW2, counts);
        buildRow(kbd, SPACE, counts);
      });

      // ìƒë‹¨ ì¹©ìŠ¤(ë‚ ì§œ ë²„íŠ¼)
      DAYS.forEach((d, i) => {
        const chip = document.createElement('button');
        chip.className = 'chip';
        chip.textContent = `${i + 1}ì¼`;
        chip.dataset.idx = i;
        chip.addEventListener('click', () => {
          document
            .querySelector(`.day[data-idx="${i}"]`)
            .scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
        chipsEl.appendChild(chip);
      });

      // í‚¤ë³´ë“œ í•œ ì¤„ ìƒì„±
      function buildRow(kbd, row, counts) {
        const frag = document.createDocumentFragment();
        row.forEach((k) => {
          const div = document.createElement('div');
          div.className = 'key' + (k === 'âµ' ? ' space' : '');
          div.dataset.k = k;
          div.textContent = k === 'âµ' ? 'ê³µë°±' : k;
          if (counts[k]) {
            div.classList.add('hit');
            const b = document.createElement('span');
            b.className = 'badge';
            b.textContent = counts[k];
            div.appendChild(b);
          }
          div.addEventListener('click', (e) => {
            const dayIdx = e.currentTarget.closest('.day').dataset.idx | 0;
            openGallery(dayIdx, k);
          });
          frag.appendChild(div);
        });
        kbd.appendChild(frag);
      }

      // ===== 5) ìŠ¤í¬ë¡¤ ê°ì§€ â†’ í™œì„± ë‚ ì§œ ì—…ë°ì´íŠ¸ =====
      const IO = new IntersectionObserver(
        (entries) => {
          entries.forEach((en) => {
            if (en.isIntersecting) {
              setActive(en.target.dataset.idx | 0);
            }
          });
        },
        { root: null, rootMargin: '-45% 0px -45% 0px', threshold: 0.01 }
      );

      document.querySelectorAll('.day').forEach((sec) => IO.observe(sec));

      function setActive(idx) {
        // ì¹© í™œì„±í™”
        document.querySelectorAll('.chip').forEach((c, i) => {
          c.classList.toggle('active', i === idx);
          if (i === idx) {
            c.scrollIntoView({
              inline: 'center',
              behavior: 'smooth',
              block: 'nearest',
            });
          }
        });
        // ì§„í–‰ë°”
        const p = idx / (DAYS.length - 1 || 1);
        progEl.style.width = (p * 100).toFixed(1) + '%';
      }

      // ===== 6) ìëª¨ ê°¤ëŸ¬ë¦¬(íƒ€ì¼ë§) =====
      const sheet = document.getElementById('sheet');
      const closeBtn = document.getElementById('closeSheet');
      const titleEl = document.getElementById('sheetTitle');
      const gal = document.getElementById('gallery');
      closeBtn.addEventListener('click', () => sheet.classList.remove('show'));
      sheet.addEventListener('click', (e) => {
        if (e.target === sheet) sheet.classList.remove('show');
      });

      function openGallery(dayIdx, jamo) {
        const d = DAYS[dayIdx];
        const arr =
          (d.photos && (d.photos[jamo] || d.photos[jamo?.toString()])) || [];
        titleEl.textContent = `${d.date} Â· ${
          jamo === 'âµ' ? 'ê³µë°±' : jamo
        } ì‚¬ì§„ ëª¨ìŒ`;
        gal.innerHTML = '';
        if (arr.length === 0) {
          // í”Œë ˆì´ìŠ¤í™€ë” 6ê°œ ìƒì„±
          for (let i = 0; i < 6; i++) {
            const ph = document.createElement('div');
            ph.className = 'tile ph';
            ph.textContent = jamo === 'âµ' ? 'âµ' : jamo;
            gal.appendChild(ph);
          }
        } else {
          arr.forEach((src) => {
            const t = document.createElement('div');
            t.className = 'tile';
            const img = document.createElement('img');
            img.loading = 'lazy';
            img.src = src;
            img.alt = `${jamo} ê´€ë ¨ ì‚¬ì§„`;
            t.appendChild(img);
            gal.appendChild(t);
          });
        }
        sheet.classList.add('show');
      }

      // ì´ˆê¸° í™œì„± ìƒíƒœ
      setActive(0);
    </script>
  </body>
</html>
